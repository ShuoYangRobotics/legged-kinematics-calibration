
figure('Name','calibrate',...
    'Units','inches',...
'Position',[0 0 3.5 5.3],...
'PaperPositionMode','auto')
clf;
plot_start_time = 6;
plot_end_time = param.data_duration-1;
plot_dt = 0.01;
plot_dim = 1;
subplot(3,1,1)
tsout = resample(cali_rho_param,plot_start_time:plot_dt:plot_end_time);
plot(tsout.Time, tsout.Data,'LineWidth',1);hold on;
plot(tsout.Time, mean(mean(tsout.Data))*ones(size(tsout.Time)),'k--','LineWidth',1)
% title('Calibrated Calf Leg Lengths')
legend('Leg1', 'Leg2', 'Leg3', 'Leg4','',...
'FontUnits','points',...
'interpreter','latex',...
'FontSize',10,...
'FontName','Times',  'Location', 'SouthWest');
set(gca,...
'Units','normalized',...
'YTick',0.19:.01:0.239,...
'XTick',plot_start_time:5:plot_end_time,...
'FontUnits','points',...
'FontWeight','normal',...
'FontSize',6,...
'FontName','Times')

ylabel({'Length (m)'},...
'FontUnits','points',...
'interpreter','latex',...
'FontSize',10,...
'FontName','Times')

xlabel({'(a) Time (s)'},...
'FontUnits','points',...
'FontWeight','normal',...
'interpreter','latex',...
'FontSize',10,...
'FontName','Times')
xlim([plot_start_time plot_end_time])
ylim([0.19 0.239])

subplot(3,1,2)
tsout = resample(sensor_data.vel_mocap,plot_start_time:plot_dt:plot_end_time);
tsout_Time = tsout.Time;
tsout_Data = tsout.Data(:,plot_dim);
p1 = plot(tsout_Time,tsout_Data,'LineWidth',1); hold on; 

tsout2 = resample(vel_est_ts1,plot_start_time:plot_dt:plot_end_time);
tsout2_Time = tsout2.Time;
tsout2_Data = tsout2.Data(:,plot_dim);
p2 = plot(tsout2_Time,tsout2_Data,'LineWidth',1); hold on;

tsout3 = resample(vel_est_ts2,plot_start_time:plot_dt:plot_end_time);
tsout3_Time = tsout3.Time;
tsout3_Data = tsout3.Data(:,plot_dim);
p3 = plot(tsout3_Time,tsout3_Data,'LineWidth',1); hold on; 


diff1 = (tsout_Data-tsout2_Data); diff1 = diff1(~isnan(diff1));s1 = sum(diff1'*diff1)/length(diff1);
diff2 = (tsout_Data-tsout3_Data); diff2 = diff2(~isnan(diff2));s2 = sum(diff2'*diff2)/length(diff1);
legend('Ground truth', sprintf('KF w/o calib = %5.4f',s1), ...
                       sprintf('KF with calib = %5.4f',s2),...
'FontUnits','points',...
'interpreter','latex',...
'FontSize',6,...
'FontName','Times',  'Location', 'SouthWest');
set(gca,...
'Units','normalized',...
'YTick',-1:.5:1,...
'XTick',plot_start_time:5:plot_end_time,...
'FontUnits','points',...
'FontWeight','normal',...
'FontSize',6,...
'FontName','Times')

ylabel({'Velocity (m/s)'},...
'FontUnits','points',...
'interpreter','latex',...
'FontSize',10,...
'FontName','Times')

xlabel({'(b) Time (s)'},...
'FontUnits','points',...
'FontWeight','normal',...
'interpreter','latex',...
'FontSize',10,...
'FontName','Times')
xlim([plot_start_time plot_end_time])
ylim([-1 1])


subplot(3,1,3)
tsout = resample(sensor_data.pos_mocap,plot_start_time:plot_dt:plot_end_time);
tsout_Time = tsout.Time;
tsout_Data = tsout.Data(:,plot_dim);
p1 = plot(tsout_Time,tsout_Data,'LineWidth',1); hold on; 

tsout2 = resample(pos_est_ts1,plot_start_time:plot_dt:plot_end_time);
tsout2_Time = tsout2.Time;
tsout2_Data = tsout2.Data(:,plot_dim);
p2 = plot(tsout2_Time,tsout2_Data,'LineWidth',1); hold on;

tsout3 = resample(pos_est_ts2,plot_start_time:plot_dt:plot_end_time);
tsout3_Time = tsout3.Time;
tsout3_Data = tsout3.Data(:,plot_dim);
p3 = plot(tsout3_Time,tsout3_Data,'LineWidth',1); hold on; 


diff1 = (tsout_Data-tsout2_Data); diff1 = diff1(~isnan(diff1));s1 = sum(diff1'*diff1)/length(diff1);
diff2 = (tsout_Data-tsout3_Data); diff2 = diff2(~isnan(diff2));s2 = sum(diff2'*diff2)/length(diff1);
legend('Ground truth', sprintf('KF w/o calib = %5.4f',s1), ...
                       sprintf('KF with calib = %5.4f',s2),...
'FontUnits','points',...
'interpreter','latex',...
'FontSize',6,...
'FontName','Times',  'Location', 'SouthWest');
set(gca,...
'Units','normalized',...
'YTick',-0.5:1:3.5,...
'XTick',plot_start_time:5:plot_end_time,...
'FontUnits','points',...
'FontWeight','normal',...
'FontSize',6,...
'FontName','Times')

ylabel({'Position (m)'},...
'FontUnits','points',...
'interpreter','latex',...
'FontSize',10,...
'FontName','Times')

xlabel({'(c) Time (s)'},...
'FontUnits','points',...
'FontWeight','normal',...
'interpreter','latex',...
'FontSize',10,...
'FontName','Times')
xlim([plot_start_time plot_end_time])
ylim([-0.5 3.5])

ha=get(gcf,'children');
set(ha(2),'position',[.11 .05 0.88 .25])
set(ha(4),'position',[.11 .38 0.88 .25])
set(ha(6),'position',[.11 .71 0.88 .25])

matlab2tikz('fig_5.tex',...
            'extraAxisOptions',{'ylabel near ticks','xlabel near ticks',...
            'scaled ticks=false',...
            'stack plots=false' })